# [機能名] 設計書

## 概要

[この機能の目的と概要を2-3文で説明]

## 設計サマリー（メタ）

```yaml
design_type: "新機能|拡張|リファクタリング"
risk_level: "低|中|高"
main_constraints:
  - "[制約1]"
  - "[制約2]"
biggest_risks:
  - "[リスク1]"
  - "[リスク2]"
unknowns:
  - "[不確実性1]"
  - "[不確実性2]"
```

## 背景と経緯

### 前提となるADR

- [ADRファイル名]: [関連する決定事項]
- 共通技術ADRも該当する場合は参照

### 合意事項チェックリスト

#### スコープ
- [ ] [変更対象の機能/コンポーネント]
- [ ] [追加する機能]

#### スコープ外（明示的に変更しないもの）
- [ ] [変更しない機能/コンポーネント]
- [ ] [維持する既存ロジック]

#### 制約
- [ ] 並行運用: [する/しない]
- [ ] 後方互換性: [必要/不要]
- [ ] パフォーマンス計測: [必要/不要]

### 解決すべき課題

[この機能が解決しようとする具体的な問題や課題]

### 現状の課題

[現在のシステムの問題点や制限事項]

### 要件

#### 機能要件

- [必須の機能要件をリストアップ]

#### 非機能要件

- **パフォーマンス**: [レスポンス時間、スループットの要件]
- **スケーラビリティ**: [負荷増大時の対応要件]
- **信頼性**: [エラー率、可用性の要件]
- **保守性**: [コードの可読性、変更容易性]

## 受入条件（AC）- EARS形式

各ACはEARS形式で記述。キーワードがテストタイプを決定。

### [機能要件1]

- [ ] **When** ユーザーが有効な認証情報でログインボタンをクリックすると、システムは認証を行いダッシュボードにリダイレクトする
- [ ] **If** 認証情報が無効な場合、**then** システムはエラーメッセージ「認証情報が無効です」を表示する
- [ ] **While** ユーザーがログインしている間、システムはセッションを60分間維持する

### [機能要件2]

- [ ] システムはデータリストを1ページ10件のページネーション付きで表示する
- [ ] **When** 検索フィールドに入力すると、システムはリアルタイムでフィルタリングを適用する
  - **Property**: `filtered.every(item => item.name.includes(query))`

## 既存コードベース分析

### 実装パスマッピング
| 種別 | パス | 説明 |
|-----|-----|-----|
| 既存 | src/[実際のパス] | [現在の実装] |
| 新規 | src/[計画パス] | [新規作成予定] |

### 統合ポイント（新規実装でも記載）
- **統合先**: [何と連携するか]
- **呼び出し方式**: [どのように呼び出されるか]

## 設計

### 変更影響マップ

```yaml
変更対象: [変更するコンポーネント/機能]
直接影響:
  - [直接変更が必要なファイル/関数]
  - [インターフェース変更箇所]
間接影響:
  - [データ形式の変更]
  - [処理時間の変化]
波及なし:
  - [明示的に影響を受けない機能]
```

### アーキテクチャ概要

[この機能がシステム全体の中でどのように位置づけられるか]

### データフロー

```
[図やシュードコードでデータの流れを表現]
```

### 統合ポイント一覧

| 統合ポイント | 箇所 | 旧実装 | 新実装 | 切替方式 |
|------------|-----|-------|-------|---------|
| 統合ポイント1 | [クラス/関数] | [既存処理] | [新処理] | [DI/Factoryなど] |
| 統合ポイント2 | [別の箇所] | [既存] | [新規] | [方式] |

### 主要コンポーネント

#### コンポーネント1

- **責務**: [このコンポーネントの責務範囲]
- **インターフェース**: [提供するAPIや型定義]
- **依存関係**: [他のコンポーネントとの関係]

#### コンポーネント2

- **責務**: [このコンポーネントの責務範囲]
- **インターフェース**: [提供するAPIや型定義]
- **依存関係**: [他のコンポーネントとの関係]

### 型定義

```typescript
// 主要な型定義をここに記載
```

### データ契約

#### コンポーネント1

```yaml
入力:
  型: [TypeScript型定義]
  前提条件: [必須項目、形式の制約]
  バリデーション: [検証方法]

出力:
  型: [TypeScript型定義]
  保証: [常に満たされる条件]
  エラー時: [例外/null/デフォルト値]

不変条件:
  - [処理前後で変わらない条件]
```

### 状態遷移と不変条件

[機能が状態管理を含む場合、状態遷移と不変条件をここに記述]

```
[状態A] ---(イベント1)---> [状態B]
[状態B] ---(イベント2)---> [状態C]
```

**不変条件**:
- [常に成立しなければならない条件]
- [有効な状態遷移の制約]

### エラーハンドリング

[エラーの種類とその処理方法]

### ロギングとモニタリング

[ログに記録する内容とモニタリング方法]

## 実装計画

### 実装アプローチ

**選択したアプローチ**: [アプローチ名または組み合わせ]
**選択理由**: [プロジェクト制約と技術的依存関係を考慮した理由]

### 技術的依存関係と実装順序

#### 必要な実装順序
1. **[コンポーネント/機能A]**
   - 技術的理由: [なぜ先に実装する必要があるか]
   - 依存要素: [これに依存する他のコンポーネント]

2. **[コンポーネント/機能B]**
   - 技術的理由: [Aの後に実装する技術的必要性]
   - 前提条件: [事前に必要な実装]

### 統合ポイント
各統合ポイントでE2E確認が必要：

**統合ポイント1: [名称]**
- コンポーネント: [コンポーネントA] -> [コンポーネントB]
- 確認方法: [統合が動作することの検証方法]

### 移行戦略

[技術的な移行アプローチ、後方互換性の確保方法]

## テスト戦略

### 単体テスト

[単体テストの方針とカバレッジ目標]
- 機能受入条件の個別要素を検証

### 統合テスト

[統合テストの方針と重要なテストケース]
- 機能受入条件の組み合わせ動作を検証

### E2Eテスト

[E2Eテストの方針]
- 受入条件のシナリオ全体を検証
- ユーザー視点での機能動作を確認

## セキュリティ考慮事項

[セキュリティ上の懸念点と対策]

## 代替案

### 代替案1

- **概要**: [代替案の説明]
- **メリット**: [利点]
- **デメリット**: [欠点]
- **不採用理由**: [採用しなかった理由]

## リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|-------|-------|---------|-----|
| [リスク1] | 高/中/低 | 高/中/低 | [対策] |

## 参考資料

- [関連するドキュメントやリンク]

## 更新履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|-----|-----------|---------|-------|
| YYYY-MM-DD | 1.0 | 初版作成 | [名前] |
