# Claude Code 開発ルール

AI実行精度最大化のための中核ルール。全ての指示はこのファイルに従う。

## 🚨 必須実行プロセス

### タスク毎の必須手順（例外なし）
1. **TodoWriteでタスク分解**
2. **各タスク開始時**: 必須チェック4項目を実行
3. **ユーザー承認待ち**（Edit/Write/MultiEdit前）
4. **実装実行**
5. **品質チェック完了まで継続**

### 必須チェック4項目（タスク開始時）
1. **rule-advisor実行済みか？** → Task toolでルール取得必須
2. **メタ認知実行済みか？** → 4質問に答えたか
3. **失敗パターン確認済みか？** → 過去の罠を確認
4. **初動アクション明確か？** → 最初の1歩が決まっているか

### 絶対禁止事項
- **any型使用**（unknown+型ガード使用）
- **メタ認知スキップ**
- **ユーザー承認なしEdit/Write/MultiEdit**
- **品質エラーありで完了**

## メタ認知実行（タスク開始時必須）

### 4質問に必ず答える
1. **タスクの本質は何か？**
   - 表面作業でなく根本目的を理解しているか
   - 「とりあえず動くように」ではないか

2. **rule-advisorの選択ルールは適切か？**
   - タスク特性に合ったルールが選ばれているか
   - 過去の記憶ではなく、現在のルールを読んでいるか

3. **過去の失敗パターンは？**
   - エラー修正衝動、一度に大変更、テスト不足を確認
   - 「今回は大丈夫」と根拠なく思っていないか

4. **最初の1ステップは何か？**
   - 具体的な第一歩が明確か
   - 計画なしにコードを書き始めようとしていないか

## Claude行動制御（失敗防止）

### 自動停止トリガー（必ず停止）
- **当初想定範囲の明らかな超過**：即座停止、ユーザー相談
- **同じエラー3回発生**：根本原因分析必須
- **Edit/Write前の承認なし検出**：即座停止
- **unknown型多用検出**：型ガード設計再検討

### エラー修正衝動対処
1. エラー発見 → **一時停止**
2. rule-advisor再実行
3. 根本原因分析（5 Whys）
4. 対処計画提示
5. ユーザー承認後に修正

### エスカレーション基準（ユーザー確認必須）
- アーキテクチャ変更
- 外部依存追加
- 破壊的変更
- 当初想定を大きく超える変更
- トレードオフ不明

### 一時ファイル作成ルール
作業中ファイルは`tmp/`ディレクトリ使用。完了時削除。

## rule-advisor使用法

### 実行方法
```
Task tool使用:
subagent_type: rule-advisor
prompt: "タスク: [具体的内容]
コンテキスト: [状況]
適切なルールセットを選択してください。"
```

### 出力の活用
1. **taskType**: タスク複雑度確認
2. **applicableRules**: 指定ルールのみ読み込み
3. **criticalPoints**: 絶対守るべき事項
4. **metaCognitiveQuestions**: 追加質問
5. **pastFailurePatterns**: 注意事項
