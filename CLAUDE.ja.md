# Claude Code 開発ルール

AI実行精度最大化のための中核ルール。全ての指示はこのファイルに従う。

## 最重要原則：調査OK、実装STOP

**すべてのEdit/Write/MultiEditツール使用前にユーザー承認が必須**

- 編集作業の前にAskUserQuestionで変更計画を提示し、明示的な承認を得ること
- 調査・読み込み・分析は承認不要

## 品質基準：技術的な妥協をしない

- 「とりあえず動く」vs「正しい実装」→ 正しい実装を選択
- ベストプラクティスに大きなコストがかかる場合 → トレードオフをユーザーに提示
- ベストプラクティスはrule-advisor（Step 1）から取得

## 必須実行プロセス

### セッション初期化

**トリガー**: セッション開始時、最初のユーザーメッセージに応答する前

- [ ] `date`コマンドで現在日時を確認
- [ ] `project-context`スキル（Skillツール使用）を実行してプロジェクトの前提を把握

### Step 1: タスク準備

**トリガー**: Edit/Write/MultiEditツールを使う作業の開始時

- [ ] rule-advisorサブエージェントを実行（Taskツール使用）
- [ ] TodoWriteを更新
  - taskEssenceを完了判断基準として記録
  - firstActionGuidanceを初動アクションとして反映
  - warningPatternsを実行中の確認項目として記録

### Step 2: 実装計画

- [ ] 影響範囲を調査し、関連ファイルを特定
- [ ] 実装アプローチをユーザーに提示
- [ ] AskUserQuestionで編集前に明示的な承認を取得

### Step 3: 実装実行

- [ ] 承認されたアプローチに従いEdit/Write/MultiEditを実行
- [ ] 3ファイル編集ごとにTodoWriteを更新（進捗と方向性を確認）

### Step 4: 品質検証

- [ ] 実装タスクの場合：quality-fixerサブエージェントを実行（Taskツール使用）
- [ ] 実装以外の場合：rule-advisorが提供した原則に基づき検証
- [ ] エラー0を確認し、完了を報告

## 自動停止トリガー

以下の条件発生時、作業を中断しステータスを報告：

| 条件 | アクション |
|------|-----------|
| 5ファイル以上の変更を検出 | 影響範囲をユーザーに報告 |
| 同じエラーが2回発生 | rule-advisor再実行、根本原因分析 |
| Editツール5回使用 | 影響範囲レポートを作成 |
| 同一ファイルを3回編集 | リファクタリングを検討 |

## エラー対処フロー

1. 一時停止
2. rule-advisor再実行
3. 根本原因分析（5 Whys）
4. 対処計画をユーザーに提示
5. 承認後に修正を実行

## ユーザー確認必須

以下の状況では実装前にユーザー確認を取得：

- アーキテクチャ変更（新レイヤー追加、責務変更）
- 外部依存の追加（npmパッケージ、外部API）
- 破壊的変更（既存API、データ構造の変更）
- 複数の実装方法があり優劣が判断できない場合

## 作業ファイル管理

作業中の一時ファイルは`./tmp/`ディレクトリ（プロジェクトルート配下）に作成。完了時に削除。
